<!DOCTYPE html>
<html>
    <head>
        <title>ANYTHING</title>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

        <style>
            @import url('https://fonts.googleapis.com/css2?family=SUSE+Mono:ital,wght@0,100..800;1,100..800&display=swap');

            body {
                background-color: black;
                background: url('graphics/4499.webp') 50%/cover no-repeat fixed;
                color: white;
                font-family: 'Poppins', sans-serif;
                overflow: hidden;
            }
            .key {
                font-family: 'SUSE Mono', monospace;
                background-color: #00000067;
                border-radius: 10px;
                padding: 1px 5px 1px 5px;
                font-style: italic;
            }
            #menu {
                position: absolute;
                top: 10px;
                left: 10px;
                padding: 0 25px 35px 25px;
                font-size: 20px;
                text-shadow: 0 1px 5px #000000b4;

                width: 250px;
                background-color: #000000b7;
                box-shadow: 0 5px 10px #0000009a;
                backdrop-filter: blur(10px);


                box-sizing: border-box;
                z-index: 100;
                border-radius: 10px;
            }
            #menu h1 {
                font-size: 25px;
                text-decoration: underline;
            }
            #panel {
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100vw;
                height: 350px;
                background: linear-gradient(to top, #0d155a9a, #0d155a00);
            }
            #velocity {
                position: absolute;
                bottom: 50px;
                left: 250px;
                text-align: center;
            }
            #velocity img {
                width: 75px;
                height: 75px;
            }



            #cube {
                position: absolute;
                width: 100px;
                height: 100px;
                filter: drop-shadow(0px 7px 7px #0000009a);
            }
            #apple {
                position: relative;
                top: -9px;
            }



            .flame {
                position: absolute;
                z-index: -1;
                transition: all linear 0.1s;
            }
            #f1 {
                top: -36px;
                left: calc(50% - 15px);
            }
            #f2 {
                top: calc(50% - 22px);
                transform: rotate(90deg);
                left: calc(100% - 4px);
            }
            #f3 {
                top: calc(100% - 13px);
                left: calc(50% - 16px);
                transform: rotate(180deg);
            }
            #f4 {
                top: calc(50% - 25px);
                transform: rotate(270deg);
                left: -25px;
            }
        </style>
    </head>
    <body>
        <div id="menu">
            <h1>Controls</h1>
            <span class="key">WASD or Arrows</span>: Movement<br /><br/>
            <span class="key">Space</span>: Toggle Gravity
        </div>

        <div id="cube">
            <img src="graphics/apple_thruster.png" id="apple" height="109"/>
            <img src="graphics/flame.png" width="30" class="flame" id="f1" />
            <img src="graphics/flame.png" width="30" class="flame" id="f2"/>
            <img src="graphics/flame.png" width="30" class="flame" id="f3"/>
            <img src="graphics/flame.png" width="30" class="flame" id="f4"/>
        </div>

        <script>
            const f1 = document.getElementById('f1');
            const f2 = document.getElementById('f2');
            const f3 = document.getElementById('f3');
            const f4 = document.getElementById('f4');

            const canvas_offset = 0;

            var obj = 'apple';
            var object_current = 0;
            const object_sheet = ['apple'];

            var objects = {
                'apple': {
                    'element': document.getElementById('cube'),
                    'pos': [0, 0],
                    'vel': [0, 0],
                    'accel': 0.05,
                    'friction': 1,
                    'bounce': 0.5
                }
            }

            var accel = 0.05;
            var friction = .995;
            var bounce = 0.5;

            var keys = {};

            var gravity = false;


            onkeydown = (e) => {
                keys[e.key.toLowerCase()] = true;
            };
            onkeyup = (e) => {
                keys[e.key.toLowerCase()] = false;
            };
            onkeypress = (e) => {
                if (e.key == ' ') {
                    gravity = !gravity;
                }
            }

            var old_time = Date.now();

            var ftime = 0;

            const cut_y = 20;
            const cut_x = 30;




            
            function frame() {
                ftime += 1;

                var new_time = Date.now();
                var dtime = new_time - old_time;
                var converted_accel = accel * dtime;
                old_time = new_time;

                if ((keys['w'] || keys['arrowup']) && /*objects[obj].vel[1] > -40 &&*/ objects[obj].pos[1] > 0) {
                    objects[obj].vel[1] += -converted_accel;
                    f3.style.opacity = 1;
                } else {
                    f3.style.opacity = 0;
                }
                if ((keys['a'] || keys['arrowleft']) && /*objects[obj].vel[0] > -40 &&*/ objects[obj].pos[0] > 0) {
                    objects[obj].vel[0] += -converted_accel;
                    f2.style.opacity = 1;
                } else {
                    f2.style.opacity = 0;
                }
                if ((keys['s'] || keys['arrowdown']) && /*objects[obj].vel[1] < 40 &&*/ objects[obj].pos[1] < (innerHeight)-objects[obj].element.offsetHeight) {
                    objects[obj].vel[1] += converted_accel;
                    f1.style.opacity = 1;
                } else {
                    f1.style.opacity = 0;
                }
                if ((keys['d'] || keys['arrowright']) && /*objects[obj].vel[0] < 40 &&*/ objects[obj].pos[0] < (innerWidth+canvas_offset)-objects[obj].element.offsetWidth) {
                    objects[obj].vel[0] += converted_accel;
                    f4.style.opacity = 1;
                } else {
                    f4.style.opacity = 0;
                }

                if (gravity) {
                    objects[obj].vel[1] += converted_accel / 1.5;
                }


                for (let i in objects) {
                    let o = objects[i];

                    o.pos[0] += o.vel[0];
                    o.pos[1] += o.vel[1];


                    if (o.vel[0] < 0 && o.pos[0] < 0) {
                        o.pos[0] = -o.pos[0];
                        o.vel[0] = -o.vel[0] * bounce;
                    } else if (o.pos[0] + o.element.offsetWidth >= (innerWidth + canvas_offset)) {
                        o.pos[0] = 2*(innerWidth + canvas_offset) - 2*(o.element.offsetWidth) - o.pos[0];
                        o.vel[0] = -o.vel[0] * bounce;
                    }
                    if (o.vel[1] < 0 && o.pos[1] < 0) {
                        o.pos[1] = -o.pos[1];
                        o.vel[1] = -o.vel[1] * bounce;
                    } else if (o.pos[1] + o.element.offsetHeight >= innerHeight) {
                        o.pos[1] = 2*innerHeight - (o.element.offsetHeight)*2 - o.pos[1];
                        o.vel[1] = -o.vel[1] * bounce;
                    }


                    o.vel[0] *= friction;
                    o.vel[1] *= friction;

                    o.element.style.left = `${o.pos[0] - canvas_offset}px`;
                    o.element.style.top = `${o.pos[1]}px`;

                }
                
                //arrow_stat.style.transform = `rotate(${(Math.atan2(objects[obj].vel[1], objects[obj].vel[0]) * 180/Math.PI + 90) % 360}deg)`;
                //vel_stat.innerText = Math.sqrt(objects[obj].vel[0]**2 + objects[obj].vel[1]**2) | 0;


                //xvel_stat.innerText = Math.abs((objects[obj].vel[0]*1000|0)/1000);
                //yvel_stat.innerText = Math.abs((objects[obj].vel[1]*1000|0)/1000);
                //gs_stat.innerText = Math.abs((Math.sqrt(objects[obj].vel[1]**2 + objects[obj].vel[0]**2)/9.8*1000|0)/1000);
                if (ftime % 10 == 1) {
                //    fps_stat.innerText = 1/dtime * 1000 | 0;
                }

                requestAnimationFrame(frame);
                //setTimeout(frame, 500);
            }
            frame();
        </script>
    </body>
</html>